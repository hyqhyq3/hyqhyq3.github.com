---
layout: post
title: openvpn服务器架设全过程
---
1.安装openvpn

#apt-get install openvpn

2.生成证书

从/usr/share/doc/openvpn/examples复制easy-rsa到/etc/openvpn目录

进入easy-rsa/2.0，编辑vars文件，在里面修改证书的一些个人信息，修改后保存

加载vars里面的配置

<code>#source vars</code>

#./clean-all

#./build-ca

#./build-key-server

#./build-key client   （这里生成客户端的证书）

#./build-dh

3.配置服务器

编辑/etc/openvpn/server.conf
<div>
<pre>local 199.193.249.182
port 1194
proto udp
dev tun
ca ./easy-rsa/2.0/keys/ca.crt
cert ./easy-rsa/2.0/keys/server.crt
key ./easy-rsa/2.0/keys/server.key  # This file should be kept secret
dh ./easy-rsa/2.0/keys/dh1024.pem
server 10.8.0.0 255.255.255.0
ifconfig-pool-persist ipp.txt
push "redirect-gateway def1"
push "dhcp-option DNS 8.8.8.8"
keepalive 10 120
comp-lzo
persist-key
persist-tun
status openvpn-status.log
verb 4</pre>
<span style="font-family: 微软雅黑;">4.配置转发</span><span style="font-family: 微软雅黑;">编辑/etc/sysctl.conf将net.ipv4.ip_forward=1的注释去掉</span><span style="font-family: 微软雅黑;">#sysctl –p</span><span style="font-family: 微软雅黑;">配置iptables转发数据包</span><span style="font-family: 微软雅黑;">#iptables -A POSTROUTING -s 10.8.0.0/24 -o eth0 -j MASQUERADE</span><span style="font-family: 微软雅黑;">#iptables-save &gt;/etc/iptables.up.rules</span><span style="font-family: 微软雅黑;">#vi /etc/network/if-pre-up.d/iptables.sh</span>
<pre>#!/bin/bash

/sbin/iptables-restore</pre>
</div>
5.重新启动服务
<pre>#service openvpn restart</pre>
6.使用客户端连接

将/etc/openvpn/easy-rsa/2.0/keys里面的client.key client.crt ca.crt下载到客户端，使用openvpn的客户端进行连接
